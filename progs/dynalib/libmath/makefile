
ifndef BASEDIR
	BASEDIR = $(CURDIR)/..
else
	BASEDIR = $1
endif

-include $(BASEDIR)/makefile.inc

INCLUDEDIR = $(BASEDIR)/include
#COMMONDIR = $(BASEDIR)/common

INCPATH = -I$(INCLUDEDIR)/

DYNALIB_TARGET_NAME=libmath.so
STATIC_LIB_TARGET_NAME=libmath.a

DYNALIB_TARGET=$(DYNAMIC_LIB_TARGET_DIR)/$(DYNALIB_TARGET_NAME)
STATIC_LIB_TARGET=$(STATIC_LIB_TARGET_DIR)/$(STATIC_LIB_TARGET_NAME)
TARGET_INSTALL_PATH=$(LIB_RPATH)/$(DYNALIB_TARGET_NAME)

REQSRC_C = math.c

C_OBJECT_FILES = $(patsubst %.c,%.o,$(REQSRC_C))

all: $(DYNALIB_TARGET) $(STATIC_LIB_TARGET)

$(STATIC_LIB_TARGET): $(C_OBJECT_FILES)
	$(ARCHIEVE_UTIL) -rcs $(STATIC_LIB_TARGET) $(C_OBJECT_FILES)

$(DYNALIB_TARGET): $(C_OBJECT_FILES)
	$(C_COMPILER) $(SHARED_LIB_FLAGS) -o $(DYNALIB_TARGET) $(C_OBJECT_FILES)

$(C_OBJECT_FILES): %.o: %.c
	$(C_COMPILER) -c -fPIC $(INCPATH) $(CFLAGS) $< -o $@
										# $< is %.c and $@ is %.o

clean:
	rm -vf $(DYNALIB_TARGET) $(STATIC_LIB_TARGET) $(C_OBJECT_FILES) $(TARGET_INSTALL_PATH)

install:
	/bin/cp -f $(DYNALIB_TARGET) $(TARGET_INSTALL_PATH)
